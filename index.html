<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Test Visor</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css">
    <style type="text/css">
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: auto;
            background: #333;
        }
        
        .frame {
            position: relative;
            top: 10px;
            left: 10px;
            width: 1000px;
            height: 600px;
            border: 5px solid #6eba7c;
        }
    </style>
    <script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.js"></script>
    <script type="text/javascript">
        var imgsList = [{
            url: 'imgs/page_1.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_2.png',
            width: 918,
            heihgt: 700,
            marks: []
        }, {
            url: 'imgs/page_3.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_4.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_5.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_6.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_7.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_8.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_9.png',
            width: 700,
            heihgt: 918,
            marks: []
        }, {
            url: 'imgs/page_10.png',
            width: 700,
            heihgt: 918,
            marks: []
        }];

        var zoomScale = 100,
            currPage = 1,
            lastPage = imgsList.length;

        function clickOnThumbnail() {
            var idx = this.getAttribute('idx');

            $('.pagePanel').animate({
                scrollTop: $('#page_' + idx)[0].offsetTop
            }, 400);
        }

        function scrollPages() {
            var scrollTop = this.scrollTop + ($(this).height() / 2),
                page = 0;

            $('.page').each(function (idx) {
                if (scrollTop > $(this)[0].offsetTop) {
                    page = idx; //$(this).attr('id');
                }
            });
            currPage = page + 1;

            $('#currPage').val(currPage + ' / ' + lastPage);
        }

        function loadImages() {
            'use strict';
            var xmlns = 'http://www.w3.org/2000/svg',
                page = [],
                svg = [],
                image = [],
                imgTemp,
                maxWidth = 0;

            for (var i = 0; i < imgsList.length; i++) {
                if (imgsList[i].width > maxWidth) {
                    maxWidth = imgsList[i].width;
                }
            }

            var factor = ($('.pagePanel')[0].clientWidth - 50) / maxWidth;

            for (var i = 0; i < imgsList.length; i++) {
                // Create thumbnails
                var thumbnail = document.createElement('div'),
                    imgThumbnail = document.createElement('img'),
                    divLabel = document.createElement('div'),
                    spanLabel = document.createElement('span');

                spanLabel.innerHTML = i + 1;
                divLabel.className = 'label';
                divLabel.appendChild(spanLabel);

                imgThumbnail.src = imgsList[i].url;

                thumbnail.className = 'thumbnail';
                thumbnail.setAttribute('idx', i);
                thumbnail.onclick = clickOnThumbnail;
                thumbnail.appendChild(imgThumbnail);
                thumbnail.appendChild(divLabel);

                $('.thumbpanel').append(thumbnail);

                // Create pages
                page[i] = document.createElement('div');
                svg[i] = document.createElementNS(xmlns, 'svg');
                image[i] = document.createElementNS(xmlns, 'image');
                imgTemp = new Image();

                imgTemp.onload = function (e) {
                    var idx = this.getAttribute('idx');

                    image[idx].setAttributeNS('http://www.w3.org/1999/xlink', 'href', this.src);
                    image[idx].setAttribute('width', this.width);
                    image[idx].setAttribute('height', this.height);

                    svg[idx].setAttribute('viewBox', '0 0 ' + this.width + ' ' + this.height);
                    svg[idx].setAttribute('width', this.width * factor);
                    svg[idx].setAttribute('height', this.height * factor);
                    svg[idx].appendChild(image[idx]);

                    page[idx].setAttribute('class', 'page');
                    page[idx].setAttribute('id', 'page_' + idx);
                    page[idx].appendChild(svg[idx]);
                };

                $('.pages').append(page[i]);

                imgTemp.setAttribute('idx', i);
                imgTemp.src = imgsList[i].url;
            }
        }

        function toggleThumbnails() {
            $('.thumbnails').toggle('blind', {
                direction: 'left',
                duration: 300
            }, function () {
                if ($('.thumbnails').is(':hidden')) {
                    $('#btnDoclist').removeClass('active');
                }
            });
        }

        function zoom(obj) {
            var value, scrollPos;

            $('.pagePanel').finish();

            scrollPos = $('.pagePanel')[0].scrollTop / $('.pagePanel')[0].scrollHeight;

            if ($(obj).attr('id') == 'zoom') {
                value = 100;
            } else if ($(obj).hasClass('zoomOut')) {
                value = (zoomScale == 50) ? 50 : zoomScale - 25;
            } else {
                value = (zoomScale == 300) ? 300 : zoomScale + 25;
            }

            $('.page svg').each(function (idx) {
                $(this).finish().animate({
                    width: $(this).width() * value / zoomScale,
                    height: $(this).height() * value / zoomScale
                }, 300);
            });

            $('.pagePanel').animate({
                fakeAttr: 300
            }, {
                step: function (now, fx) {
                    fx.elem.scrollTop = fx.elem.scrollHeight * scrollPos;
                },
                duration: 300,
                complete: function () {
                    zoomScale = value;
                    $('#zoom').html(value + '%');
                }
            });
        }

        $(function () {
            $('#btnIndex').click(function () {
                if ($(this).hasClass('active')) {
                    $(this).removeClass('active');
                } else {
                    if ($('.thumbnails').is(':visible')) {
                        toggleThumbnails();
                    }

                    $('.option').removeClass('active');
                    $(this).addClass('active');
                }
            });

            $('#btnDoclist').click(function () {
                var btnDocklist = this;

                if ($('.thumbnails').is(':hidden')) {
                    $('.option').removeClass('active');
                    $('#btnDoclist').addClass('active');
                }

                toggleThumbnails();
            });

            $('.btnPage.prev, .btnPage.next').click(function (e) {
                if ($(this).hasClass('prev')) {
                    if (currPage == 1) return;
                    currPage -= 1;
                } else if ($(this).hasClass('next')) {
                    if (currPage == lastPage) return;
                    currPage += 1;
                }

                $('.pagePanel').off('scroll', scrollPages);
                $('.pagePanel').stop().animate({
                    scrollTop: $('#page_' + currPage)[0].offsetTop
                }, 400, function () {
                    setTimeout(function () {
                        $('.pagePanel').scroll(scrollPages);
                    }, 500);
                });

                $('#currPage').val(currPage + ' / ' + lastPage);
            });

            $('.pagePanel').scroll(scrollPages);

            $('#currPage').focus(function () {
                this.select();
            });

            $('#currPage').keypress(function (e) {
                var idx;
                if (e.which == 13) {
                    idx = parseInt($(this).val() - 1);

                    if (isNaN(idx)) {
                        $(this).val(currPage + ' / ' + lastPage);
                        return;
                    }

                    if (idx < 0) {
                        idx = 0;
                    } else if (idx > lastPage) {
                        idx = lastPage - 1;
                    }

                    $('.pagePanel').animate({
                        scrollTop: $('#page_' + idx)[0].offsetTop
                    }, 400);

                    $(this).val(idx + ' / ' + lastPage);

                    currPage = idx;

                    e.target.blur();
                }
            });

            loadImages();
        });
    </script>
</head>

<body>
    <div class="frame">
        <div class="viewerPanel">
            <div class="sidebar">
                <div class="options">
                    <div id="btnDoclist" class="option active">
                        <img src="icons/thumbs.svg">
                    </div>
                    <div id="btnIndex" class="option">
                        <img src="icons/toc.svg">
                    </div>
                </div>
                <div class="thumbnails">
                    <div class="thumbpanel"></div>
                </div>
            </div>
            <div class="docPanel">
                <div class="pagePanel">
                    <div class="pages"></div>
                </div>
                <div class="statusBar">
                    <div class="ctrlPage">
                        <div class="btnPage prev">
                            <img src="icons/left.svg">
                        </div>
                        <div class="btnPage">
                            <input id="currPage" type="text" value="1 / 10">
                        </div>
                        <div class="btnPage next">
                            <img src="icons/right.svg">
                        </div>
                    </div>
                    <div class="ctrlZoom">
                        <div class="btnZoom zoomOut" onclick="zoom(this)">
                            <img src="icons/zoomOut.svg">
                        </div>
                        <div class="txtZoom">
                            <span id="zoom" onclick="zoom(this)">100%</span>
                        </div>
                        <div class="btnZoom zoomIn" onclick="zoom(this)">
                            <img src="icons/zoomIn.svg">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>